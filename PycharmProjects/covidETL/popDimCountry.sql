use covid

if OBJECT_ID('tempdb..#temp') is not null
	drop table #temp
select * from DimCountry

select Unpvt.date,Unpvt.Country, Unpvt.total_cases
into #temp
from [covid].[dbo].stg_source_total_cases c

unpivot (
total_cases for Country in (
Afghanistan,
Albania,
Algeria,
Andorra,
Angola,
Anguilla,
AntiguaandBarbuda,
Argentina,
Armenia,
Aruba,
Australia,
Austria,
Azerbaijan,
Bahamas,
Bahrain,
Bangladesh,
Barbados,
Belarus,
Belgium,
Belize,
Benin,
Bermuda,
Bhutan,
Bolivia,
BonaireSintEustatiusandSaba,
BosniaandHerzegovina,
Botswana,
Brazil,
BritishVirginIslands,
Brunei,
Bulgaria,
BurkinaFaso,
Burundi,
Cambodia,
Cameroon,
Canada,
CapeVerde,
CaymanIslands,
CentralAfricanRepublic,
Chad,
Chile,
China,
Colombia,
Comoros,
Congo,
CostaRica,
CotedIvoire,
Croatia,
Cuba,
Curacao,
Cyprus,
CzechRepublic,
DemocraticRepublicofCongo,
Denmark,
Djibouti,
Dominica,
DominicanRepublic,
Ecuador,
Egypt,
ElSalvador,
EquatorialGuinea,
Eritrea,
Estonia,
Ethiopia,
FaeroeIslands,
FalklandIslands,
Fiji,
Finland,
France,
FrenchPolynesia,
Gabon,
Gambia,
Georgia,
Germany,
Ghana,
Gibraltar,
Greece,
Greenland,
Grenada,
Guam,
Guatemala,
Guernsey,
Guinea,
GuineaBissau,
Guyana,
Haiti,
Honduras,
Hungary,
Iceland,
India,
Indonesia,
International,
Iran,
Iraq,
Ireland,
IsleofMan,
Israel,
Italy,
Jamaica,
Japan,
Jersey,
Jordan,
Kazakhstan,
Kenya,
Kosovo,
Kuwait,
Kyrgyzstan,
Laos,
Latvia,
Lebanon,
Lesotho,
Liberia,
Libya,
Liechtenstein,
Lithuania,
Luxembourg,
Macedonia,
Madagascar,
Malawi,
Malaysia,
Maldives,
Mali,
Malta,
Mauritania,
Mauritius,
Mexico,
Moldova,
Monaco,
Mongolia,
Montenegro,
Montserrat,
Morocco,
Mozambique,
Myanmar,
Namibia,
Nepal,
Netherlands,
NewCaledonia,
NewZealand,
Nicaragua,
Niger,
Nigeria,
NorthernMarianaIslands,
Norway,
Oman,
Pakistan,
Palestine,
Panama,
PapuaNewGuinea,
Paraguay,
Peru,
Philippines,
Poland,
Portugal,
PuertoRico,
Qatar,
Romania,
Russia,
Rwanda,
SaintKittsandNevis,
SaintLucia,
SaintVincentandtheGrenadines,
SanMarino,
SaoTomeandPrincipe,
SaudiArabia,
Senegal,
Serbia,
Seychelles,
SierraLeone,
Singapore,
SintMaartenDutchpart,
Slovakia,
Slovenia,
Somalia,
SouthAfrica,
SouthKorea,
SouthSudan,
Spain,
SriLanka,
Sudan,
Suriname,
Swaziland,
Sweden,
Switzerland,
Syria,
Taiwan,
Tajikistan,
Tanzania,
Thailand,
Timor,
Togo,
TrinidadandTobago,
Tunisia,
Turkey,
TurksandCaicosIslands,
Uganda,
Ukraine,
UnitedArabEmirates,
UnitedKingdom,
UnitedStates,
UnitedStatesVirginIslands,
Uruguay,
Uzbekistan,
Vatican,
Venezuela,
Vietnam,
WesternSahara,
Yemen,
Zambia,
Zimbabwe)
) as Unpvt;

with cte_countries (Country) as(
select distinct Country from #temp

where Country not in( 
select Country from DimCountry
)

)

--select * from cte_countries

merge DimCountry t using cte_countries s
on (t.CountryName = s.Country)

when not matched  
	then insert(CountryName)
	values (s.Country);



--select * from DimCountry









